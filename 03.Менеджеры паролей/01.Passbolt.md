## Требования

1. ОС не ниже Ubuntu 22.04
2. Доменое имя/имя хоста указывающее на сервер. Возможность связаться с сервером из вне.
3. Работающий SMTP-сервер для уведомлений по электронной почте
4. Работающая служба NTP, для избежания проблем с аутентификацией GPG
5. Рекомендуемые требования к серверу: 2 ядра, 2гб оперативной памяти

## Подготовка

### Настройка NTP

Проверяем включен ли NTP:
```bash
timedatectl status
```

Если NTP service: inactive
```
System clock synchronized: no
				NTP service: inactive
```
То выполняем: 

```bash
sudo apt install chrony -y
sudo systemctl restart chrony.service
timedatectl status
```
 После выполнения данных дейсвий вывод должен быть таким:
 ![[Pasted image 20230510095842.png]]

### Правила брендмауэра

#### Для входящего трафика:
| Имя протокола | Номер порта | Протокол транспортного уровня | Комментарий                                                               |
|---------------|-------------|-------------------------------|---------------------------------------------------------------------------|
| HTTP          | 80          | Протокол tcp                  | Необязательный, должен использоваться только для перенаправления на HTTPS |
| HTTPS         | 443         | Протокол tcp                  | Обслуживание Passbolt через HTTPS                                         |

#### Для исходящего трафика:
| Имя протокола | Номер порта | Протокол транспортного уровня | Комментарий                                                                                                                                               |
|---------------|-------------|-------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------|
| HTTP          | 80          | Протокол tcp                  | Чтобы иметь возможность подключаться к репозиториям операционной системы, которые не используют https (Ubuntu)                                            |
| HTTPS         | 443         | Протокол tcp                  | Чтобы иметь возможность подключаться к репозиторию пакетов или репозиторию bitbucket                                                                      |
| SMTP | обычно 587  | Протокол tcp                  | Для отправки уведомлений по электронной почте используется порт в зависимости от конфигурации вашего SMTP-сервера, обычно это 25/TCP, 587/TCP или 465/TCP |
| DNS           | 53          | UDP                           | Чтобы иметь возможность разрешить имя SMTP-сервера, или download.passbolt.com проверить наличие обновлений                                                |
| NTP           | 123         | UDP                           | Синхронизация сервера с NTP-сервером. Обязательно для работы GPG или MFA/OTP                                                                              |
| HKPS          | 11371       | Протокол tcp                  | Протокол HKPS для получения GPG-ключей                                                                                                                    |


### Делаем что бы сервер был доступен по доменному имени

```bash
hostnamectl set-hostmane pass.sobyaninyd.ru
```
Где ``pass.sobyaninyd.ru`` это доменное имя сервера.

Далее вносим правки в  ``/etc/hosts`` 
```bash
192.168.68.111 pass.sobyaninyd.ru pass
```

Далее осталось сделать проброс на роутере из внешней сети на  192.168.68.111


## Установка
### Репозитарии
**Шаг 1.**  Скачиваем скрипт для установки зависимостей:
```bash
wget "https://download.passbolt.com/ce/installer/passbolt-repo-setup.ce.sh"
```

**Шаг 2.** Скачиваем наш SHA512SUM для скрипта установки:
```bash
wget https://github.com/passbolt/passbolt-dep-scripts/releases/latest/download/passbolt-ce-SHA512SUM.txt
```

**Шаг 3.** Убеждаемся, что сценарий действителен, и выполняем его:
```bash
	sha512sum -c passbolt-ce-SHA512SUM.txt && sudo bash ./passbolt-repo-setup.ce.sh  || echo \"Bad checksum. Aborting\" && rm -f passbolt-repo-setup.ce.sh
```



### Установка PassBolt

```bash
sudo apt install passbolt-ce-server
```
#### Настройка mysql
Если не указано иное, пакет passbolt установит mysql-server локально. Этот шаг поможет создать пустую базу данных MySQL для использования Passbolt.
![[Pasted image 20230510102727.png]]
В процессе настройки будут запрошены учетные данные пользователя mysql admin для создания новой базы данных. По умолчанию в большинстве установок имя пользователя администратора будет пустым, а пароль пустым.`root`

![Диалоговое окно администратора базы данных](https://help.passbolt.com/assets/img/help/2020/05/debian-package/mysql_admin_user.png) 
		Диалоговое окно администратора базы данных

![Диалоговое окно передачи администратора базы данных](https://help.passbolt.com/assets/img/help/2020/05/debian-package/mysql_admin_user_pass.png)
	Диалоговое окно передачи администратора базы данных

Теперь нужно создать пользователя mysql с ограниченными правами для подключения passbolt. Эти значения будут запрошены позже в инструменте веб-конфигурации passbolt.

![Диалоговое окно пользователя пароля базы данных](https://help.passbolt.com/assets/img/help/2020/05/debian-package/passbolt_db_user_name.png)
					Диалоговое окно пользователя пароля базы данных

![Диалоговое окно передачи пользователя Passbolt базы данных](https://help.passbolt.com/assets/img/help/2020/05/debian-package/passbolt_db_user_pass.png)
		Диалоговое окно передачи пользователя Passbolt базы данных

Далее нам нужно создать базу данных для использования passbolt, для этого нам нужно назвать ее:

![Диалоговое окно "Имя базы данных"](https://help.passbolt.com/assets/img/help/2020/05/debian-package/db_name.png)
						Диалоговое окно "Имя базы данных"

#### Настройка nginx для обслуживания HTTPS

В зависимости от потребностей существует два различных варианта настройки nginx
##### Let's Encrypt
<iframe src="https://help.passbolt.com/configure/https/ce/debian/auto.html" allow="fullscreen" allowfullscreen="" style="height: 100%; width: 100%; aspect-ratio: 16 / 9;"></iframe>

##### Вручную (с использованием SSL-сертификатов, предоставленных пользователем)
<iframe src="https://help.passbolt.com/configure/https/ce/debian/manual.html" allow="fullscreen" allowfullscreen="" style="height:100%;width:100%; aspect-ratio: 16 / 9; "></iframe>

## Настройка PassBolt

Перед использованием необходимо произвести настройку. Для этого необходимо в браузере перейти на сервер по ip или домееному имени. В моем случае это ``https://pass.sobyaninyd.ru`` Попадаем на страницу "Начало работы"
![[Pasted image 20230510113825.png|Страница приветствия Passbolt перед настройкой]]

### Проверка работоспособности
На первой странице мастера будет проведена проверка и указано все ли соотвествует требованиям для нормального функцианирования PassBolt
![[Pasted image 20230510114103.png|Проверка соотвествия требованиям]]

### База данных
На данном этапе необходимо указать какую базу будем использовать и данные для подключения к базе
![[Pasted image 20230510114256.png|Подключение к базе данных]]

### Ключ GPG
В этом разделе можно сгенерировать или импортировать пару ключей GPG. Эта пара ключей будет использоваться API passbolt для аутентифиции во время процесса подтверждения входа в систему.
**Сгенерируйте ключ**, если у вас его нет:
![[Pasted image 20230510114656.png|Генерация ключей]]

**Необязательно**: импортируйте ключ, если он у вас уже есть и вы хотите, чтобы ваш сервер использовал его.

>==**Не устанавливайте парольную фразу или срок действия** Модуль php-gnupg на данный момент не поддерживает использование парольной фразы. Убедитесь, что вы его не установили. Точно так же не устанавливайте срок годности. В противном случае всем вашим пользователям потребуется Выполните восстановление учетной записи, когда вам в конечном итоге потребуется обновить ключ.==

Чтобы создать новый ключ GnuPG без парольной фразы, выполните следующие действия.
```bash
gpg --batch --no-tty --gen-key <<EOF
  Key-Type: default
  Key-Length: 2048
  Subkey-Type: default
  Subkey-Length: 2048
  Name-Real: Yaroslav Sobyanin
  Name-Email: SobyaninYD@yandex.ru
  Expire-Date: 0
  %no-protection
  %commit
EOF
```

Чтобы отобразить новый ключ, необходимо выполнить:
```bash
gpg --armor --export-secret-keys SobyaninYD@yandex.ru
```
![[Pasted image 20230510120254.png|Импорт пары ключей]]

### Почтовый сервер (SMTP)
На этом этапе мастер попросит ввести данные вашего SMTP-сервера.

![[Pasted image 20230510120523.png|Ввод сведений для подключения почтового сервера]]

В моем случае это выглядит вот так:
![[Pasted image 20230510120645.png|Уже подключенный SMTP сервер]]

Также можно проверить правильность конфигурации с помощью функции проверки электронной почты в правой части экрана. Вводим адрес электронной почты, на который хотим, чтобы мастер отправил тестовое письмо, и нажимаем «Отправить тестовое письмо».
![[Pasted image 20230510120832.png|Проверка SMTP]]

На почту придет письмо следующего содержания: 
![[Pasted image 20230510121056.png]]

### Создание первого пользователя
Необходимо создать первую учетную запись администратора.
![[Pasted image 20230510121507.png]]

### Установка
После ввода всех параметров начнется процесс установки.
![[Pasted image 20230510121720.png]]

По окончанию процесса установки мы будем перенаправлены на страницу настройки пользователя
## Настройка учетной записи администратора

### Скачайте плагин
Прежде чем продолжить, passbolt потребует загрузить его плагин. Если он уже установлен, вы можете перейти на страницу Следующий шаг
![[Pasted image 20230510123101.png|Требование скачать расширение]]

### Создание нового ключа

Passbolt попросит создать или импортировать ключ, который позже будет использоваться для идентификации и шифрования ваших паролей. Этот ключ должен быть защищен паролем. Выбираем его с умом, с его помощью будет обеспечиваться доступ к остальным паролям.
![[Pasted image 20230510123320.png|Генерация ключа]]

### Загрузка комплекта восстановления
Этот шаг очень важен. Ваш ключ - единственный способ получить доступ к вашей учетной записи и паролям. Если вы потеряете этот ключ (путем взлома или, например, потеря компьютера и отсутствие резервной копии), ваши зашифрованные данные будут потеряны, даже если вы помните свою парольную фразу.
![[Pasted image 20230510123510.png|Загрузка комплекта восстановления]]

### Определите свой токен безопасности
Выбор цвета и трехсимвольного токена — это дополнительный механизм безопасности, который помогает определить фишинг. Каждый раз, когда вы выполняете конфиденциальную операцию с passbolt, вы должны видеть этот токен.
![[Pasted image 20230510123719.png|Ввод и маркировка токена безопасности]]

Учетная запись администратора настроена. Вы будете перенаправлены на страницу входа в систему passbolt.



#pass #документация #pasbolt 
## Обновление
### Остановка работы сайта
Как правило, рекомендуется прекратить работу сайта перед обновлением. Это делается для того, чтобы избежать проблем например, активные пользователи повреждают данные в середине обновления.
```bash
sudo systemctl stop nginx
```

### Сделайте резервную копию базы данных
Задокументировать опираясь на статью: 
<iframe src="https://help.passbolt.com/hosting/backup" allow="fullscreen" allowfullscreen="" style="height: 100%; width: 100%; aspect-ratio: 16 / 9;"></iframe>

### Обновите систему
```bash
apt-get update && apt-get dist-upgrade -y
```

>==Иногда, когда также есть обновление MySQL / MariaDB, вы получите сообщение об ошибке на этапе обновления. Чтобы решить эту проблему, выполните следующие действия: `sudo apt --only-upgrade install passbolt-ce-server``sudo apt upgrade`==

```bash
sudo apt-get --only-upgrade install passbolt-ce-server && sudo apt-get dist-upgrade -y
```

#### Очистите кеш
Наконец, убедитесь, что вы очистили кэш приложения, чтобы убедиться, что любые изменения в структуре базы данных отражаются в файлах кэша модели
```bash
sudo -H -u www-data bash -c "/usr/share/php/passbolt/bin/cake cache clear_all"
```

```bash
sudo systemctl start nginx
```

## Устранение неполадок
#### Проверка статуса
При желании вы можете войти в систему как администратор и проверить статус на странице проверки работоспособности:

![[Pasted image 20230510130851.png|Проверка статуса работоспособности]]

В моем случае это `https://pass.sobyaninyd.ru/healthcheck`

Тоже самое можно проверить командой:
```bash
sudo -H -u www-data bash -c "/usr/share/php/passbolt/bin/cake passbolt healthcheck"
```
![[Pasted image 20230510131112.png|Проверка работоспособности через терминал]]


## PassBolt для администратора
![[02.PassBolt для администратора]]


## PassBolt для пользователя
![[03.PassBolt для пользователей]]